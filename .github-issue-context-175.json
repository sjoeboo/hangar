{
  "type": "pull_request",
  "number": 175,
  "title": "fix(slack): remove thread context fetching from Slack handler",
  "body": "This is not working well because the thread context can becomes quickly big and at the conductor/claude fail to correctly handling it. For now keeping simple way which is working well.\r\n\r\nOnly forward the incoming message to the conductor without prepending thread history. Removes _fetch_thread_context and the unused channel/ current_ts parameters from _handle_slack_text.",
  "author": "mtparet",
  "url": "https://github.com/asheshgoplani/agent-deck/pull/175",
  "state": "open",
  "draft": false,
  "mergeable": null,
  "base_branch": "main",
  "head_branch": "fix_slack_thread",
  "created_at": "2026-02-16T15:34:44Z",
  "updated_at": "2026-02-16T15:34:44Z",
  "additions": 1,
  "deletions": 44,
  "changed_files_count": 1,
  "labels": [],
  "files": [
    {
      "filename": "internal/session/conductor_templates.go",
      "status": "modified",
      "additions": 1,
      "deletions": 44,
      "patch": "@@ -945,47 +945,14 @@ def create_slack_app(config: dict):\n         conductors = discover_conductors()\n         return conductors[0] if conductors else None\n \n-    async def _fetch_thread_context(channel: str, thread_ts: str, current_ts: str) -> str:\n-        \"\"\"Fetch previous messages in a thread and format as context.\n-\n-        Returns a formatted string with thread history, or empty string if\n-        not in a thread or fetch fails.\n-        \"\"\"\n-        try:\n-            result = await app.client.conversations_replies(\n-                channel=channel, ts=thread_ts, limit=50,\n-            )\n-            messages = result.get(\"messages\", [])\n-            if len(messages) <= 1:\n-                return \"\"  # Only the current message, no context needed\n-\n-            lines = []\n-            for msg in messages:\n-                # Skip the current message (will be sent separately)\n-                if msg.get(\"ts\") == current_ts:\n-                    continue\n-                user = msg.get(\"user\", \"bot\")\n-                txt = msg.get(\"text\", \"\")\n-                # Strip bot mentions for readability\n-                txt = re.sub(r\"<@[A-Z0-9]+>\\s*\", \"\", txt).strip()\n-                if txt:\n-                    lines.append(f\"<@{user}>: {txt}\")\n-\n-            if not lines:\n-                return \"\"\n-            return \"[Thread context]\\n\" + \"\\n\".join(lines) + \"\\n[New message]\\n\"\n-        except Exception as e:\n-            log.warning(\"Failed to fetch thread context: %s\", e)\n-            return \"\"\n-\n     async def _safe_say(say, **kwargs):\n         \"\"\"Wrapper around say() that catches network/API errors.\"\"\"\n         try:\n             await say(**kwargs)\n         except Exception as e:\n             log.error(\"Slack say() failed: %s\", e)\n \n-    async def _handle_slack_text(text: str, say, thread_ts: str = None, channel: str = None, current_ts: str = None):\n+    async def _handle_slack_text(text: str, say, thread_ts: str = None):\n         \"\"\"Shared handler for Slack mes"
    }
  ],
  "commits": [
    {
      "sha": "b2b33d3",
      "message": "fix(slack): remove thread context fetching from Slack handler",
      "author": "Matthieu Paret"
    }
  ],
  "reviews": [],
  "comments": [],
  "review_comments": [],
  "related": [],
  "detected_type": "bugfix"
}
